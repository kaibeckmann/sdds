#include <unistd.h>
#include <sdds/sDDS.h>
#include "test_history_sdds_impl.h"

int main()
{
    printf ("History: ");
    Log_setLvl(5);
    sDDS_init ();

    NetBuffRef_t buff;
    NetBuffRef_init(&buff);
    NetBuffRef_renew(&buff);
    buff.subMsgCount = 1;
    buff.curPos = 4;
    buff.curDomain = 1;
    buff.curTopic = g_Strings_topic;
    buff.buff_start = (byte_t []) {0x01, 0x03, 0x10, 0x11, 0x32, 0x48, 0x45, 0x00, 0x45, 0x73, 0x00, 0x45, 0x73, 0x20, 0x67, 0x69, 0x62, 0x74, 0x20, 0x69, 0x6d, 0x20, 0x4d, 0x6f, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x69, 0x6e, 0x20, 0x64, 0x69, 0x65, 0x73, 0x00, 0x45, 0x73, 0x20, 0x67, 0x69, 0x62, 0x74, 0x20, 0x69, 0x6d, 0x20, 0x4d, 0x6f, 0x6d, 0x65, 0x6e, 0x74, 0x20, 0x69, 0x6e, 0x20, 0x64, 0x69, 0x65, 0x73, 0x65, 0x20, 0x4d, 0x61, 0x6e, 0x6e, 0x73, 0x63, 0x68, 0x61, 0x66, 0x74, 0x2c, 0x20, 0x6f, 0x68, 0x2c, 0x20, 0x65, 0x69, 0x6e, 0x69, 0x67, 0x65, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    rc_t rc;
    Sample_t samples[3];
    History_t history;
    TimeStampSimple_t ts;

    rc = sdds_History_setup (&history, &samples[0], 3);
    assert (rc == SDDS_RT_OK);
    //  Enqueue
    rc = sdds_History_enqueue (&history, &buff);
    assert (rc == SDDS_RT_OK);

    //  Dequeue
    Sample_t *mysample;
    mysample = sdds_History_dequeue (&history);
    assert (mysample);
    Strings e1 = *((Strings*) mysample->data);
    assert (e1.schar == 'H');
    assert (strcmp (e1.s_string, "E") == 0);
    assert (strcmp (e1.m_string, "Es") == 0);
    assert (strcmp (e1.l_string, "Es gibt im Moment in dies") == 0);
    assert (strcmp (e1.xl_string, "Es gibt im Moment in diese Mannschaft, oh, einige ") == 0);

    printf ("OK\n");
    return 0;
}
